<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Test Marvel</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css"
        integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm" crossorigin="anonymous">
    <script src="https://www.gstatic.com/firebasejs/5.10.1/firebase.js"></script>
    <script src="https://code.jquery.com/jquery-3.4.0.js"
        integrity="sha256-DYZMCC8HTC+QDr5QNaIcfR7VSPtcISykd+6eSmBW5qo=" crossorigin="anonymous"></script>
</head>

<body>
    <button class="btn btn-primary" id="submit">Character search </button>
    <!-- <div class="card">
        <h5 class="card-header text-center">
            HULK
        </h5>
        <img class="card-img-top" src="https://media.giphy.com/media/aS8ypUweGOXMA/giphy.gif" alt="Card image cap">
        <div class="card-body">
            <p class="card-text">Some quick example text to build on the card title and make up the bulk of the card's
                content.</p>
        </div>
        <ul class="list-group list-group-flush">
            <li class="list-group-item">Power Points:</li>
            <li class="list-group-item">Dapibus ac facilisis in</li>
        </ul>
        <div class="card-body">
            <a href="#" class="card-link">Call to Action</a>
        </div>
    </div> -->

    <script>
        $(document).ready(function () {

            // function createCharCard(response){
            //     var charName = response.
            // }


            var characters = [
                "Spider-Man", "Thor", "Hulk", "Iron-Man", "Captain-America", "Wolverine", "Thanos", "DeadPool", "Doctor-Strange"
            ]


            // Initialize Firebase
            var config = {
                apiKey: "AIzaSyBuVunkkdUj9Lh7ghjP2JmLXJLI42K55jQ",
                authDomain: "marveltest-9558a.firebaseapp.com",
                databaseURL: "https://marveltest-9558a.firebaseio.com",
                projectId: "marveltest-9558a",
                storageBucket: "marveltest-9558a.appspot.com",
                messagingSenderId: "557399982087"
            };
            firebase.initializeApp(config);
            database = firebase.database();

            // Marvel Key
            const marvelKey = "3825528115714235769b996819f21ef0";
            // Giphy Key
            const giphyKey = "F0y8OeTPpYSZkVLz2fLvNXdxqtpfpPSp";


            $("#submit").on("click", (e) => {
                e.preventDefault();




                // Make call to Marvel for random character
                var charIndex = Math.floor(Math.random() * 9);
                var chartoSearch = characters[charIndex];
                // Marvel Query Built
                var marvelQuery = "https://gateway.marvel.com:443/v1/public/characters?name=" + chartoSearch + "&limit=2&apikey=" + marvelKey;
                console.log("Marvel Query: " + marvelQuery);
                // Giphy Query Built
                var giphyQuery = "https://api.giphy.com/v1/gifs/search?q=" + chartoSearch + "&limit=1&api_key=" + giphyKey;
                console.log("Giphy Query: " + giphyQuery);

                $.ajax({
                    url: marvelQuery,
                    method: "GET"
                }).then(response => {
                    console.log(response);
                    response = response.data;
                    // Store description in variable
                    var description = response.results[0].comics.description;
                    console.log(description);
                    
                    $.ajax({
                        url: giphyQuery,
                        method: "GET"
                    }).then(response => {
                        console.log(response);
                        // Store gif url in variable
                        var gifURL = response.data[0].images.fixed_height.url;
                        console.log(gifURL);
                        // Initialize battlecred to 0
                        var battleCred = 0;

                        // Create object to push to database
                        // database.ref("characters/").push({
                        //     name: chartoSearch,
                        //     gif: gifURL,
                        //     description: description,
                        //     battlecred: battleCred
                        // });

                        // Create char card based on firebase data


                    }).catch(err => console.log(err))
                }).catch(err => console.log(err))
            })

        })





// User comes to page. Clicks Battle Button
// Two calls are made to marvel to get random character names
// If the character name is in our firebase...load a character card based on firebase data.
// If the name is not in our firebase... create JSON object to push to firebase based on:
// Name from Marvel, giphy url (make a call with the name from marvel), description of character (from original Marvel call)
// And initialize the battle creds to 0.

// Now we should have two character cards on the screen that are represented in firebase.
// Define on click event listener: when a user clicks a card...they are saying that they believe that character would win 
// in a 1 v 1 fight.  Increment the battle creds of the winner.

    </script>
</body>

</html>